/*!
 * Proa Tools Intranet v2.10.0 (https://github.com/proa-data/proa-tools-intranet)
 */
angular.module("proaTools.intranet",["ngLocale","ui.router","pascalprecht.translate","ngMaterial","ui.bootstrap","proaTools.records","proaTools.forms"]),function(){function a(a){a.useStaticFilesLoader({prefix:"json/lang/",suffix:".json"}).useSanitizeValueStrategy(null)}a.$inject=["$translateProvider"],angular.module("proaTools.intranet").config(a)}(),angular.module("proaTools.intranet").constant("PT_TEMPLATES",{login:'<div class="container" id="container-login"><img class="img-responsive center-block" src="img/logo.png"><div><div class="alert alert-info"><p translate="login.wellcome1"></p><p translate="login.wellcome2"></p></div><form class="form-horizontal m-bottom" name="loginForm" novalidate ng-submit="submit(loginForm)"><div class="form-group" ng-class="{\'has-error\': submitted&&loginForm.user.$error.required}"><label class="col-sm-2 control-label"><span class="fas fa-user fa-lg"></span></label><div class="col-sm-10"><input type="text" class="form-control" placeholder="{{\'login.name\' | translate}}" name="user" ng-model="loginData.user" required></div></div><div class="form-group" ng-class="{\'has-error\': submitted&&loginForm.pass.$error.required}"><label class="col-sm-2 control-label"><span class="fas fa-lock fa-lg"></span></label><div class="col-sm-10"><input type="password" class="form-control" placeholder="{{\'login.password\' | translate}}" name="pass" ng-model="loginData.pass" required></div></div><div class="form-group" ng-if="selectCompany"><label class="col-sm-2 control-label"><span class="fas fa-users fa-lg"></span></label><div class="col-sm-10"><select class="form-control" name="company" ng-model="userData.id_empresa" ng-options="item.id as item.name for item in companyItems" ng-change="submitWithCompany()"></select></div></div><button type="submit" class="btn btn-primary btn-block" ng-disabled="!isready" translate="login.login"></button></form><p class="alert alert-danger" ng-show="submitted&&loginForm.company.$error.required"><span translate="login.error.company1"><strong translate="login.error.company"></strong>.</p><p class="alert alert-danger" ng-show="submitted&&loginForm.user.$error.required"><span translate="error.initMas"></span><strong translate="login.error.name"></strong>.</p><p class="alert alert-danger" ng-show="submitted&&loginForm.pass.$error.required"><span translate="error.initFem"></span> <strong translate="login.error.password></strong>.</p><p class="alert alert-danger" ng-show="submitted&&notPermiss"><span translate="login.error.initNoLogin"></span><strong translate="login.error.noLogin"></strong>.</p><p class="alert alert-danger" ng-show="requiredUpdatePassword"><span translate="login.error.update_password_required"></span>.</p><p class="alert alert-danger" ng-show="submitted&&errorServer"><span translate="login.error.server1"></span><strong translate="login.error.server2"></strong>.</p></div></div>',main:'<header><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" ng-click="isNavCollapsed=!isNavCollapsed"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-brand" ng-if="userData.logo_contenido"><img ng-src="data:image/png;base64,{{userData.logo_contenido}}"></div></div><div class="navbar-text"><ol class="breadcrumb"><li ng-repeat="item in breadcrumbList" ng-class="{active: item.sref}"><a ui-sref="{{item.sref}}" translate="{{item.translationId}}" ng-if="item.sref"></a><span translate="{{item.translationId}}" ng-if="!item.sref"></span></li></ol></div><ul class="nav navbar-nav navbar-right"><li uib-dropdown><a href="" uib-dropdown-toggle role="button"><img class="img-responsive img-circle" ng-src="data:image/jpeg;base64,{{userData.contenido_foto}}" onerror="this.onerror=null;this.src=\'img/default-avatar.jpg\'"> <span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">{{userData.nombre}} ({{userData.id_usuario}})</li><li role="separator" class="divider"></li><li><a href="" ng-click="openModal()"><span class="fas fa-user fa-fw"></span> <span translate="manageUser.title_dropdown"></span></a></li><li><a href="" ng-click="logout()"><span class="fas fa-power-off fa-fw"></span> <span translate="manageUser.logout_dropdown"></span></a></li></ul></li></ul><div class="navbar-collapse" uib-collapse="isNavCollapsed"><ul class="nav navbar-nav"><li ng-repeat-start="item in navList" ng-if="isDisplayed(item)&&item.submenu"><a href="" ng-init="isSubnavCollapsed=true" ng-click="isSubnavCollapsed=!isSubnavCollapsed"><span ng-include="\'nav-content.html\'"></span> <span class="caret"></span></a><ul class="nav navbar-nav" uib-collapse="isSubnavCollapsed"><li ui-sref-active="active" ng-include="\'nav-link.html\'" ng-repeat="item in item.submenu" ng-if="isDisplayed(item)"></li></ul></li><li ui-sref-active="active" ng-include="\'nav-link.html\'" ng-repeat-end ng-if="isDisplayed(item)&&!item.submenu"></li></ul></div></div></nav><script type="text/ng-template" id="nav-link.html"><a ui-sref="main.{{item.name}}" ng-include="\'nav-content.html\'"></a><\/script><script type="text/ng-template" id="nav-content.html"><span class="fa-fw" ng-class="item.iconClassName" ng-if="item.iconClassName"></span><span ng-if="item.iconClassName"> </span><span translate="{{item.name}}.title"></span><\/script></header><main class="container-fluid" ui-view></main>',modal:'<md-dialog flex="50"><md-toolbar><div class="md-toolbar-tools"><h2 translate="manageUser.title"></h2><span flex></span><md-button class="md-icon-button" ng-click="closeDialog()"><span class="fas fa-times"></span></md-button></div></md-toolbar><md-dialog-content><md-tabs md-selected="modalTabIndex" md-dynamic-height md-border-bottom><md-tab label="updateData"><md-tab-label><span translate="manageUser.updateData"></span></md-tab-label><md-tab-body><div class="tab-body"><form ng-submit="saveData()"><p class="alert alert-danger" translate="error.noUserData" ng-show="isNoUserData()"></p><div class="form-group"><label translate="manageUser.nif"></label><input type="text" class="form-control" ng-model="data.nif" required></div><div class="form-group"><label translate="manageUser.email"></label><input type="email" class="form-control" ng-model="data.email" required></div><button type="submit" class="btn btn-primary" translate="save"></button></form></div></md-tab-body></md-tab><md-tab label="updatePassword"><md-tab-label><span translate="manageUser.updatePassword"></span></md-tab-label><md-tab-body><div class="tab-body"><form ng-submit="saveNewPassword()"><div class="form-group" ng-class="{\'has-error\': failOldPassword&&submittedResetPassword}"><label translate="manageUser.password.current"></label><input type="password" ng-model="resetPasswordForm.current_password" class="form-control" required></div><div class="form-group"><label translate="manageUser.password.new"></label><input type="password" ng-model="resetPasswordForm.new_password" class="form-control" required></div><div class="form-group" ng-class="{\'has-error\': failSameNewPassword&&submittedResetPassword}"><label translate="manageUser.password.repeatNew"></label><input type="password" ng-model="resetPasswordForm.repeat_new_password" class="form-control" required></div><p class="alert alert-danger" translate="manageUser.password.fail_new_password" ng-if="failSameNewPassword"></p><p class="alert alert-danger" translate="manageUser.password.fail_old_password" ng-if="failOldPassword"></p><button type="submit" class="btn btn-primary"><span class="fas fa-sync-alt"></span><span translate="manageUser.password.update"></span></button></form></div></md-tab-body></md-tab><md-tab label="updatePicture"><md-tab-label><span translate="manageUser.updatePicture"></span></md-tab-label><md-tab-body><div class="tab-body text-center"><img id="profileImage" ng-src="data:image/jpeg;base64,{{photoContent}}" class="img-responsive img-circle center-block m-bottom" alt="Profile picture" onerror="this.onerror = null;this.src=\'img/default-avatar.jpg\'" width="150"><input type="file" id="input-new-image" accept="image/*;capture=camera" onchange="angular.element(this).scope().processNewImage(this)" image="" resize-max-height="1000" resize-max-width="1000" resize-quality="0.7" resize-type="image/jpg" accept=".jpg,.jpeg,.png" class="hidden"><button type="button" class="btn btn-primary" ng-click="getNewImage()"><span class="fas fa-camera fa-2x"></span></button></div></md-tab-body></md-tab></md-tabs></md-dialog-content></md-dialog>',home:'<h1 class="h3" translate="largeTitle"></h1>'}),function(){function a(t,r,e,n,s,a,o){function i(){t.isready=!1,a.getCompanies().then(function(a){a?(t.companyItems=a,1==t.companyItems.length?(n.userData.id_empresa=t.companyItems[0].id,n.userData.id_oficina=t.companyItems[0].officeCode,r.start(n.userData),l()):t.selectCompany=!0):t.errorServer=!0,t.isready=!t.isready})}function l(){o.go("main.home")}t.loginData={},t.selectCompany=!1,t.isready=!0,t.submitted=!1,t.submit=function(a){if(a.$invalid)return void(t.submitted=!0);e.doLogin(t.loginData.user,md5(t.loginData.pass)).then(function(a){if(a){r.start(a);var e=n.userData;e&&e.validado?(t.requiredUpdatePassword=!1,t.loginData.user==t.loginData.pass?s(1).then(function(a){a?i():t.requiredUpdatePassword=!0}):i()):(void 0===e?t.errorServer=!0:t.notPermiss=!0,t.submitted=!0)}else void 0===a?t.errorServer=!0:t.notPermiss=!0,t.submitted=!0})},t.submitWithCompany=function(){0!=n.userData.id_empresa?(angular.forEach(t.companyItems,function(a){a.id==n.userData.id_empresa&&(n.userData.id_oficina=a.officeCode)}),r.start(n.userData),l()):t.submitted=!0},r.logout()}function e(t,r,s,o,i,a){t.navList=[];var l={};function u(){s.logout()}function d(){a()}t.isDisplayed=function(a){return l[a.name]},t.logout=u,t.openModal=d,function(){var a=r.userData;if(!s.isUserAuthorized()||null===a)return u();a.nif&&a.email||d();t.navList=o;var n=[];angular.forEach(o,function(e){var a=e.submenu;a?angular.forEach(a,function(a){(a=angular.copy(a)).parent=e.name,n.push(a)}):n.push(e)});var e={};angular.forEach(n,function(a){e[a.permission]=1}),e=_.keys(e),i.checkPermissions(e.join()).then(function(a){if(a){var e=a[0].permisos,t=s.getUserData();t.permisos=e,s.setUserData(t),angular.forEach(e,function(r){angular.forEach(n,function(a){if(r.recurso==a.permission){var e=!!r.visualizar;if(l[a.name]=e){var t=a.parent;t&&(l[t]=!0)}}})})}})}()}function t(a,s,e,t,r,o,i){var l=a.userData;function n(){t.hide()}s.modalTabIndex=e,s.closeDialog=n,s.data={nif:l.nif,email:l.email},s.isNoUserData=function(){var a=s.data;return!(a.nif&&a.email)},s.saveData=function(){var a=angular.copy(s.data);r.request("GuardarDatosUsuario",[l.id_usuario,a]).then(function(){l.nif=a.nif,l.email=a.email,o.setUserData(l),n()})},s.saveNewPassword=function(){s.submittedResetPassword=!0,s.failSameNewPassword=!1,s.failOldPassword=!1,s.emptyNewPassword=!1;var a=l.id_usuario;if(null==s.resetPasswordForm)s.emptyNewPassword=!0;else{var e=s.resetPasswordForm.current_password,t=s.resetPasswordForm.new_password,r=s.resetPasswordForm.repeat_new_password;t!==r?s.failSameNewPassword=!0:null==t?s.emptyNewPassword=!0:i.resetPassword(a,md5(e),md5(t)).then(function(a){var e=a;1==e[0]?n(e[0]):s.failOldPassword=!0})}},s.submittedResetPassword=!1,s.photoContent=l.contenido_foto,s.getNewImage=function(){document.getElementById("input-new-image").click(),s.invalidQRCode=!1,s.isRequired=!1,s.noResultsVehicle=!1,s.vehicleNumberNew=""},s.processNewImage=function(a){s.errorUpdatingPicture=!1;var e=l.id_usuario,t=a.files,n=new FileReader;n.onload=function(){var r=n.result;i.updateUserPicture(e,r).then(function(a){var e=a;if(1==e[0].fields.Fresultado){var t=r.substring(r.indexOf(",")+1);l.ruta_foto=e[0].fields.Fmensaje,l.contenido_foto=t,o.setUserData(l),document.getElementById("profileImage").src=r}else s.errorUpdatingPicture=!0})},n.readAsDataURL(t[0])}}a.$inject=["$scope","ptSessionService","ptApiService","$rootScope","ptOpenProfileModal","dataService","$state"],e.$inject=["$scope","$rootScope","ptSessionService","ptScreens","ptApiService","ptOpenProfileModal"],t.$inject=["$rootScope","$scope","modalTabIndex","$mdDialog","dsApi","ptSessionService","ptApiService"],angular.module("proaTools.intranet").controller("PtLoginController",a).controller("PtMainController",e).controller("PtModalController",t)}(),function(){function a(l){return{restrict:"E",compile:function(a,e){var s=angular.isDefined(e.multiple),o=e.ngModel,t=a.find("md-option"),r=t.attr("ng-repeat").split("in")[1].split("|")[0],i=t.attr("ng-value").split(".")[1];return function(n){n.$watch(r,function(a){var e={};angular.forEach(a,function(a){e[a[i]]=!0});var t,r=n.$eval(o);s?(t=[],angular.forEach(r,function(a){a in e&&t.push(a)}),l(function(){n.$$finalSelectedValue=t,n.$eval(o+"=$$finalSelectedValue"),delete n.$$finalSelectedValue})):r in e||n.$eval(o+"=undefined")})}}}}a.$inject=["$timeout"],angular.module("ngMaterial").directive("mdSelect",a)}(),function(){function a(a,r){var n=new RegExp("\\s*\\"+a.NUMBER_FORMATS.CURRENCY_SYM+"\\s*","g"),s=a.RANGE_SEP;return function(a){var e=[];for(var t in a)e[t]=r(a[t]).replace(n,"");return r(1/0).replace("∞",e.join(s))}}function e(a){var e=a.ANSWERS;return function(a){return e[a?1:0]}}a.$inject=["$locale","currencyFilter"],e.$inject=["$locale"],angular.module("proaTools.intranet").filter("currencyRange",a).filter("answer",e)}(),function(){function a(c,e,t){var m=[];this.$get=function(){return m},this.setAll=function(a){c.state("login",{url:"/login",template:e.login,controller:"PtLoginController"}).state("main",{url:"/",template:e.main,controller:"PtMainController"}).state("main.home",{url:"home",template:e.home}),t.otherwise("/home");var d={};angular.forEach(a,function(a){var e=a.parent,t={name:a.name,permission:a.permission,iconClassName:a.iconClassName};if(e){var r=d[e];r||(r=d[e]=[]),r.push(t)}else m.push(t);if(!a.noTemplate){var n=a.name,s=_.kebabCase(n),o={url:s,templateUrl:"app/"+s+"/view.html"},i="main."+n,l=a.param;if(a.noController||(o.controller=_.upperFirst(n)+"Controller"),e&&(o.data={parentMenu:e}),c.state(i,o),l){var u=angular.copy(o);u.url="/:"+l,c.state(i+"."+l,u)}}}),angular.forEach(d,function(e,t){angular.forEach(m,function(a){a.name==t&&(a.submenu=e)})})}}a.$inject=["$stateProvider","PT_TEMPLATES","$urlRouterProvider"],angular.module("proaTools.intranet").provider("ptScreens",a)}(),function(){function a(a,e,t,r,n,s,i,o){a.use(e()),angular.merge(t,r);var l=t.DATETIME_FORMATS;n.shortDays=l.SHORTDAY,n.firstDayOfWeek=[1,2,3,4,5,6,0][l.FIRSTDAYOFWEEK];var u=l.paddedShortDate.replace(/y/g,"Y").replace(/d/g,"D");function d(a,e){return(a?a+".":"")+(e||"title")}n.formatDate=function(a){if(!a)return"";var e=a.toLocaleTimeString(),t=a;return 0!==a.getHours()||-1===e.indexOf("11:")&&-1===e.indexOf("23:")||(t=new Date(a.getFullYear(),a.getMonth(),a.getDate(),1,0,0)),moment(t).format(u)},n.parseDate=function(a){var e=moment(a,u,!0);return e.isValid()?e.toDate():new Date(NaN)},s.get("about.json").then(function(a){var e=a.data;console.info('Package: "'+e.name+'" v'+e.version+".")}),i.$on("$stateChangeSuccess",function(a,e){var t=e.name,r=t.split(".")[1],n=[],s=e.data;if(i.pageTitleTranslationId=d(r,"largeTitle"),r&&n.push({translationId:d(r),sref:t}),s){var o=s.parentMenu;o&&n.unshift({translationId:d(o)})}i.breadcrumbList=n}),i.userData=o.getUserData()}a.$inject=["$translate","getLang","$locale","$extraLocale","$mdDateLocale","$http","$rootScope","ptSessionService"],angular.module("proaTools.intranet").run(a)}(),function(){function a(a){return function(){return a.id.split("-").shift()}}function e(n,s,o){var i=angular.noop,l=void 0;return{setErrorAlert:function(a){i=a},setPath:function(a){l=a+"datasnap/rest/TMethods/"},request:function(a,e){return function(a,e){var t={"User-Token":s.getToken()},r=o.userData;r&&(t["User-Company"]=r.id_empresa);return n.post(l+a,{_parameters:e||[]},{headers:t}).then(function(a){var e=a.data,t=e[0];if(t){var r=t.fields;if(r&&!1===r.Fresultado)throw console.error(r.Fmensaje),i(),e}return e},function(a){var e=a.data,t=e.error;console.error(t||e),403==a.status||t&&t.includes("NOT_VALIDATED")?s.logout():i();throw e})}(a,e)}}}function t(s,o,i){var l=angular.noop,u=void 0;return{setErrorAlert:function(a){l=a},setPath:function(a){u=a},get:a("get"),post:a("post"),put:a("put"),delete:a("delete")};function a(r){return function(a,e,t){return function(a,e,t,r){var n={method:a,url:u+e,headers:{Authorization:"Bearer "+s.getToken()}};t=t||{},r&&(t.pageLength=o.itemsPerPage,t.pageNum=r.currentPage-1);switch(a){case"get":case"delete":n.params=t;break;case"post":case"put":n.data=t}return i(n).then(function(a){var e=a.data;r&&(r.totalItems=e.totalElements,r.data=e.content);return e},function(a){console.error(a.statusText);var e=a.data;"message"in e&&console.error(e.message);401==a.status?s.logout():l();throw e})}(r,a,e,t)}}}function r(r,e){return{doLogin:function(a,e){return r.request("ValidarUsuario",[a,e,"",!1,"web"]).then(function(a){return a[0]})},checkPermissions:function(a){return r.request("ObtenerPermisos",[e.userData.id_usuario,a])},resetPassword:function(a,e,t){return r.request("CambiarPassword",[a,e,t])},updateUserPicture:function(a,e){return r.request("ActualizarFotoUsuario",[a,e])}}}function n(a,e,t){var r={token:"ptToken",userData:"ptUserData"},n=a.localStorage;return{start:function(a){s(a),n.setItem(r.token,a.token)},isUserAuthorized:function(){return null!==o()},setUserData:s,getUserData:function(){var a=n.getItem(r.userData);return null!==a?angular.fromJson(a):null},getToken:o,logout:function(){n.clear(),delete e.userData,t.go("login")}};function s(a){n.setItem(r.userData,angular.toJson(a)),e.userData=a}function o(){return n.getItem(r.token)}}function s(e,t){return function(a){return e.show({template:t.modal,controller:"PtModalController",locals:{modalTabIndex:a||0}})}}a.$inject=["$locale"],e.$inject=["$http","ptSessionService","$rootScope"],t.$inject=["ptSessionService","uibPaginationConfig","$http"],r.$inject=["dsApi","$rootScope"],n.$inject=["$window","$rootScope","$state"],s.$inject=["$mdDialog","PT_TEMPLATES"],angular.module("proaTools.intranet").factory("getLang",a).factory("getStringDate",function(){return function(a){return a instanceof Date?a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate():""}}).factory("dsApi",e).factory("springApi",t).factory("ptApiService",r).factory("ptSessionService",n).factory("ptOpenProfileModal",s)}(),angular.module("proaTools.intranet").value("$extraLocale",{DATETIME_FORMATS:{paddedMedium:"MM/dd/yyyy HH:mm:ss",paddedMediumDate:"MM/dd/yyyy",paddedMediumTime:"HH:mm:ss",paddedShort:"MM/dd/yyyy HH:mm",paddedShortDate:"MM/dd/yyyy",paddedShortTime:"HH:mm",filenameMedium:"M-d-yyyy H.mm.ss",filenameMediumDate:"M-d-yyyy",filenameMediumTime:"H.mm.ss"},RANGE_SEP:"-",ANSWERS:["No","Yes"]});
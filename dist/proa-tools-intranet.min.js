/*!
 * Proa Tools Intranet v2.11.0 (https://github.com/proa-data/proa-tools-intranet)
 */
angular.module("proaTools.intranet",["ngLocale","ui.router","pascalprecht.translate","ngMaterial","ui.bootstrap","proaTools.records","proaTools.forms"]),function(){function e(e){e.useStaticFilesLoader({prefix:"json/lang/",suffix:".json"}).useSanitizeValueStrategy(null)}e.$inject=["$translateProvider"],angular.module("proaTools.intranet").config(e)}(),angular.module("proaTools.intranet").constant("PT_TEMPLATES",{login:'<div class="container" id="container-login"><img class="img-responsive center-block" src="img/logo.png"><div><div class="alert alert-info"><p translate="login.wellcome1"></p><p translate="login.wellcome2"></p></div><form class="form-horizontal m-bottom" name="loginForm" novalidate ng-submit="submit(loginForm)"><div class="form-group" ng-class="{\'has-error\': submitted&&loginForm.user.$error.required}"><label class="col-sm-2 control-label"><span class="fas fa-user fa-lg"></span></label><div class="col-sm-10"><input type="text" class="form-control" placeholder="{{\'login.name\' | translate}}" name="user" ng-model="loginData.user" required></div></div><div class="form-group" ng-class="{\'has-error\': submitted&&loginForm.pass.$error.required}"><label class="col-sm-2 control-label"><span class="fas fa-lock fa-lg"></span></label><div class="col-sm-10"><input type="password" class="form-control" placeholder="{{\'login.password\' | translate}}" name="pass" ng-model="loginData.pass" required></div></div><div class="form-group" ng-if="selectCompany"><label class="col-sm-2 control-label"><span class="fas fa-users fa-lg"></span></label><div class="col-sm-10"><select class="form-control" name="company" ng-model="userData.id_empresa" ng-options="item.id as item.name for item in companyItems" ng-change="submitWithCompany()"></select></div></div><button type="submit" class="btn btn-primary btn-block" ng-disabled="!isready" translate="login.login"></button></form><p class="alert alert-danger" ng-show="submitted&&loginForm.company.$error.required"><span translate="login.error.company1"><strong translate="login.error.company"></strong>.</p><p class="alert alert-danger" ng-show="submitted&&loginForm.user.$error.required"><span translate="error.initMas"></span><strong translate="login.error.name"></strong>.</p><p class="alert alert-danger" ng-show="submitted&&loginForm.pass.$error.required"><span translate="error.initFem"></span> <strong translate="login.error.password></strong>.</p><p class="alert alert-danger" ng-show="submitted&&notPermiss"><span translate="login.error.initNoLogin"></span><strong translate="login.error.noLogin"></strong>.</p><p class="alert alert-danger" ng-show="requiredUpdatePassword"><span translate="login.error.update_password_required"></span>.</p><p class="alert alert-danger" ng-show="submitted&&errorServer"><span translate="login.error.server1"></span><strong translate="login.error.server2"></strong>.</p></div></div>',main:'<header><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" ng-click="isNavCollapsed=!isNavCollapsed"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-brand" ng-if="userData.logo_contenido"><img ng-src="data:image/png;base64,{{userData.logo_contenido}}"></div></div><div class="navbar-text"><ol class="breadcrumb"><li ng-repeat="item in breadcrumbList" ng-class="{active: item.sref}"><a ui-sref="{{item.sref}}" translate="{{item.translationId}}" ng-if="item.sref"></a><span translate="{{item.translationId}}" ng-if="!item.sref"></span></li></ol></div><ul class="nav navbar-nav navbar-right"><li uib-dropdown><a href="" uib-dropdown-toggle role="button"><img class="img-responsive img-circle" ng-src="data:image/jpeg;base64,{{userData.contenido_foto}}" onerror="this.onerror=null;this.src=\'img/default-avatar.jpg\'"> <span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">{{userData.nombre}} ({{userData.id_usuario}})</li><li role="separator" class="divider"></li><li><a href="" ng-click="openModal()"><span class="fas fa-user fa-fw"></span> <span translate="manageUser.title_dropdown"></span></a></li><li><a href="" ng-click="logout()"><span class="fas fa-power-off fa-fw"></span> <span translate="manageUser.logout_dropdown"></span></a></li></ul></li></ul><div class="navbar-collapse" uib-collapse="isNavCollapsed"><ul class="nav navbar-nav"><li ng-repeat-start="item in navList" ng-if="isDisplayed(item)&&item.submenu"><a href="" ng-init="isSubnavCollapsed=true" ng-click="isSubnavCollapsed=!isSubnavCollapsed"><span ng-include="\'nav-content.html\'"></span> <span class="caret"></span></a><ul class="nav navbar-nav" uib-collapse="isSubnavCollapsed"><li ui-sref-active="active" ng-include="\'nav-link.html\'" ng-repeat="item in item.submenu" ng-if="isDisplayed(item)"></li></ul></li><li ui-sref-active="active" ng-include="\'nav-link.html\'" ng-repeat-end ng-if="isDisplayed(item)&&!item.submenu"></li></ul></div></div></nav><script type="text/ng-template" id="nav-link.html"><a ui-sref="main.{{item.name}}" ng-include="\'nav-content.html\'"></a><\/script><script type="text/ng-template" id="nav-content.html"><span class="fa-fw" ng-class="item.iconClassName" ng-if="item.iconClassName"></span><span ng-if="item.iconClassName"> </span><span translate="{{item.name}}.title"></span><\/script></header><main class="container-fluid" ui-view></main>',modal:'<md-dialog flex="50"><md-toolbar><div class="md-toolbar-tools"><h2 translate="manageUser.title"></h2><span flex></span><md-button class="md-icon-button" ng-click="closeDialog()"><span class="fas fa-times"></span></md-button></div></md-toolbar><md-dialog-content><md-tabs md-selected="modalTabIndex" md-dynamic-height md-border-bottom><md-tab label="updateData"><md-tab-label><span translate="manageUser.updateData"></span></md-tab-label><md-tab-body><div class="tab-body"><form ng-submit="saveData()"><p class="alert alert-danger" translate="error.noUserData" ng-show="isNoUserData()"></p><div class="form-group"><label translate="manageUser.nif"></label><input type="text" class="form-control" ng-model="data.nif" required></div><div class="form-group"><label translate="manageUser.email"></label><input type="email" class="form-control" ng-model="data.email" required></div><button type="submit" class="btn btn-primary" translate="save"></button></form></div></md-tab-body></md-tab><md-tab label="updatePassword"><md-tab-label><span translate="manageUser.updatePassword"></span></md-tab-label><md-tab-body><div class="tab-body"><form ng-submit="saveNewPassword()"><div class="form-group" ng-class="{\'has-error\': failOldPassword&&submittedResetPassword}"><label translate="manageUser.password.current"></label><input type="password" ng-model="resetPasswordForm.current_password" class="form-control" required></div><div class="form-group"><label translate="manageUser.password.new"></label><input type="password" ng-model="resetPasswordForm.new_password" class="form-control" required></div><div class="form-group" ng-class="{\'has-error\': failSameNewPassword&&submittedResetPassword}"><label translate="manageUser.password.repeatNew"></label><input type="password" ng-model="resetPasswordForm.repeat_new_password" class="form-control" required></div><p class="alert alert-danger" translate="manageUser.password.fail_new_password" ng-if="failSameNewPassword"></p><p class="alert alert-danger" translate="manageUser.password.fail_old_password" ng-if="failOldPassword"></p><button type="submit" class="btn btn-primary"><span class="fas fa-sync-alt"></span><span translate="manageUser.password.update"></span></button></form></div></md-tab-body></md-tab><md-tab label="updatePicture"><md-tab-label><span translate="manageUser.updatePicture"></span></md-tab-label><md-tab-body><div class="tab-body text-center"><img id="profileImage" ng-src="data:image/jpeg;base64,{{photoContent}}" class="img-responsive img-circle center-block m-bottom" alt="Profile picture" onerror="this.onerror = null;this.src=\'img/default-avatar.jpg\'" width="150"><input type="file" id="input-new-image" accept="image/*;capture=camera" onchange="angular.element(this).scope().processNewImage(this)" image="" resize-max-height="1000" resize-max-width="1000" resize-quality="0.7" resize-type="image/jpg" accept=".jpg,.jpeg,.png" class="hidden"><button type="button" class="btn btn-primary" ng-click="getNewImage()"><span class="fas fa-camera fa-2x"></span></button></div></md-tab-body></md-tab></md-tabs></md-dialog-content></md-dialog>',home:'<h1 class="h3" translate="largeTitle"></h1>'}),function(){function e(t,r,a,n,s,e,o){function i(){t.isready=!1,e.getCompanies().then(function(e){e?(t.companyItems=e,1==t.companyItems.length?(n.userData.id_empresa=t.companyItems[0].id,n.userData.id_oficina=t.companyItems[0].officeCode,r.start(n.userData),l()):t.selectCompany=!0):t.errorServer=!0,t.isready=!t.isready})}function l(){o.go("main.home")}t.loginData={},t.selectCompany=!1,t.isready=!0,t.submitted=!1,t.submit=function(e){if(e.$invalid)return void(t.submitted=!0);a.doLogin(t.loginData.user,md5(t.loginData.pass)).then(function(e){if(e){r.start(e);var a=n.userData;a&&a.validado?(t.requiredUpdatePassword=!1,t.loginData.user==t.loginData.pass?s(1).then(function(e){e?i():t.requiredUpdatePassword=!0}):i()):(void 0===a?t.errorServer=!0:t.notPermiss=!0,t.submitted=!0)}else void 0===e?t.errorServer=!0:t.notPermiss=!0,t.submitted=!0})},t.submitWithCompany=function(){0!=n.userData.id_empresa?(angular.forEach(t.companyItems,function(e){e.id==n.userData.id_empresa&&(n.userData.id_oficina=e.officeCode)}),r.start(n.userData),l()):t.submitted=!0},r.logout()}function a(t,r,s,o,i,e){t.navList=[];var l={};function d(){s.logout()}function u(){e()}t.isDisplayed=function(e){return l[e.name]},t.logout=d,t.openModal=u,function(){var e=r.userData;if(!s.isUserAuthorized()||null===e)return d();e.nif&&e.email||u();t.navList=o;var n=[];angular.forEach(o,function(a){var e=a.submenu;e?angular.forEach(e,function(e){(e=angular.copy(e)).parent=a.name,n.push(e)}):n.push(a)});var a={};angular.forEach(n,function(e){a[e.permission]=1}),a=_.keys(a),i.checkPermissions(a.join()).then(function(e){if(e){var a=e[0].permisos,t=s.getUserData();t.permisos=a,s.setUserData(t),angular.forEach(a,function(r){angular.forEach(n,function(e){if(r.recurso==e.permission){var a=!!r.visualizar;if(l[e.name]=a){var t=e.parent;t&&(l[t]=!0)}}})})}})}()}function t(e,s,a,t,r,o,i){var l=e.userData;function n(){t.hide()}s.modalTabIndex=a,s.closeDialog=n,s.data={nif:l.nif,email:l.email},s.isNoUserData=function(){var e=s.data;return!(e.nif&&e.email)},s.saveData=function(){var e=angular.copy(s.data);r.request("GuardarDatosUsuario",[l.id_usuario,e]).then(function(){l.nif=e.nif,l.email=e.email,o.setUserData(l),n()})},s.saveNewPassword=function(){s.submittedResetPassword=!0,s.failSameNewPassword=!1,s.failOldPassword=!1,s.emptyNewPassword=!1;var e=l.id_usuario;if(null==s.resetPasswordForm)s.emptyNewPassword=!0;else{var a=s.resetPasswordForm.current_password,t=s.resetPasswordForm.new_password,r=s.resetPasswordForm.repeat_new_password;t!==r?s.failSameNewPassword=!0:null==t?s.emptyNewPassword=!0:i.resetPassword(e,md5(a),md5(t)).then(function(e){var a=e;1==a[0]?n(a[0]):s.failOldPassword=!0})}},s.submittedResetPassword=!1,s.photoContent=l.contenido_foto,s.getNewImage=function(){document.getElementById("input-new-image").click(),s.invalidQRCode=!1,s.isRequired=!1,s.noResultsVehicle=!1,s.vehicleNumberNew=""},s.processNewImage=function(e){s.errorUpdatingPicture=!1;var a=l.id_usuario,t=e.files,n=new FileReader;n.onload=function(){var r=n.result;i.updateUserPicture(a,r).then(function(e){var a=e;if(1==a[0].fields.Fresultado){var t=r.substring(r.indexOf(",")+1);l.ruta_foto=a[0].fields.Fmensaje,l.contenido_foto=t,o.setUserData(l),document.getElementById("profileImage").src=r}else s.errorUpdatingPicture=!0})},n.readAsDataURL(t[0])}}e.$inject=["$scope","ptSessionService","ptApiService","$rootScope","ptOpenProfileModal","dataService","$state"],a.$inject=["$scope","$rootScope","ptSessionService","ptScreens","ptApiService","ptOpenProfileModal"],t.$inject=["$rootScope","$scope","modalTabIndex","$mdDialog","dsApi","ptSessionService","ptApiService"],angular.module("proaTools.intranet").controller("PtLoginController",e).controller("PtMainController",a).controller("PtModalController",t)}(),function(){function e(l){return{restrict:"E",compile:function(e,a){var s=angular.isDefined(a.multiple),o=a.ngModel,t=e.find("md-option"),r=t.attr("ng-repeat").split("in")[1].split("|")[0],i=t.attr("ng-value").split(".")[1];return function(n){n.$watch(r,function(e){var a={};angular.forEach(e,function(e){a[e[i]]=!0});var t,r=n.$eval(o);s?(t=[],angular.forEach(r,function(e){e in a&&t.push(e)}),l(function(){n.$$finalSelectedValue=t,n.$eval(o+"=$$finalSelectedValue"),delete n.$$finalSelectedValue})):r in a||n.$eval(o+"=undefined")})}}}}function a(a){return{restrict:"E",template:'<div class="modal-backdrop fade in" id="modal-backdrop-spinner" ng-show="isLoading()"><md-progress-circular md-mode="indeterminate"></md-progress-circular></div>',replace:!0,scope:!0,link:function(e){e.isLoading=function(){return a.pendingRequests.length}}}}e.$inject=["$timeout"],a.$inject=["$http"],angular.module("ngMaterial").directive("mdSelect",e),angular.module("proaTools.intranet").directive("ptSpinner",a)}(),function(){function e(e,r){var n=new RegExp("\\s*\\"+e.NUMBER_FORMATS.CURRENCY_SYM+"\\s*","g"),s=e.RANGE_SEP;return function(e){var a=[];for(var t in e)a[t]=r(e[t]).replace(n,"");return r(1/0).replace("∞",a.join(s))}}function a(e){var a=e.ANSWERS;return function(e){return a[e?1:0]}}e.$inject=["$locale","currencyFilter"],a.$inject=["$locale"],angular.module("proaTools.intranet").filter("currencyRange",e).filter("answer",a)}(),function(){function e(c,a,t){var m=[];this.$get=function(){return m},this.setAll=function(e){c.state("login",{url:"/login",template:a.login,controller:"PtLoginController"}).state("main",{url:"/",template:a.main,controller:"PtMainController"}).state("main.home",{url:"home",template:a.home}),t.otherwise("/home");var u={};angular.forEach(e,function(e){var a=e.parent,t={name:e.name,permission:e.permission,iconClassName:e.iconClassName};if(a){var r=u[a];r||(r=u[a]=[]),r.push(t)}else m.push(t);if(!e.noTemplate){var n=e.name,s=_.kebabCase(n),o={url:s,templateUrl:"app/"+s+"/view.html"},i="main."+n,l=e.param;if(e.noController||(o.controller=_.upperFirst(n)+"Controller"),a&&(o.data={parentMenu:a}),c.state(i,o),l){var d=angular.copy(o);d.url="/:"+l,c.state(i+"."+l,d)}}}),angular.forEach(u,function(a,t){angular.forEach(m,function(e){e.name==t&&(e.submenu=a)})})}}e.$inject=["$stateProvider","PT_TEMPLATES","$urlRouterProvider"],angular.module("proaTools.intranet").provider("ptScreens",e)}(),function(){function e(e,a,t,r,n,s,i,o){e.use(a()),angular.merge(t,r);var l=t.DATETIME_FORMATS;n.shortDays=l.SHORTDAY,n.firstDayOfWeek=[1,2,3,4,5,6,0][l.FIRSTDAYOFWEEK];var d=l.paddedShortDate.replace(/y/g,"Y").replace(/d/g,"D");function u(e,a){return(e?e+".":"")+(a||"title")}n.formatDate=function(e){if(!e)return"";var a=e.toLocaleTimeString(),t=e;return 0!==e.getHours()||-1===a.indexOf("11:")&&-1===a.indexOf("23:")||(t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),1,0,0)),moment(t).format(d)},n.parseDate=function(e){var a=moment(e,d,!0);return a.isValid()?a.toDate():new Date(NaN)},s.get("about.json").then(function(e){var a=e.data;console.info('Package: "'+a.name+'" v'+a.version+".")}),i.$on("$stateChangeSuccess",function(e,a){var t=a.name,r=t.split(".")[1],n=[],s=a.data;if(i.pageTitleTranslationId=u(r,"largeTitle"),r&&n.push({translationId:u(r),sref:t}),s){var o=s.parentMenu;o&&n.unshift({translationId:u(o)})}i.breadcrumbList=n}),i.userData=o.getUserData()}e.$inject=["$translate","getLang","$locale","$extraLocale","$mdDateLocale","$http","$rootScope","ptSessionService"],angular.module("proaTools.intranet").run(e)}(),function(){function e(e){return function(){return e.id.split("-").shift()}}function a(n,s,o){var i=angular.noop,l=void 0;return{setErrorAlert:function(e){i=e},setPath:function(e){l=e+"datasnap/rest/TMethods/"},request:function(e,a){return function(e,a){var t={"User-Token":s.getToken()},r=o.userData;r&&(t["User-Company"]=r.id_empresa);return n.post(l+e,{_parameters:a||[]},{headers:t}).then(function(e){var a=e.data,t=a[0];if(t){var r=t.fields;if(r&&!1===r.Fresultado)throw console.error(r.Fmensaje),i(),a}return a},function(e){var a=e.data,t=a.error;console.error(t||a),403==e.status||t&&t.includes("NOT_VALIDATED")?s.logout():i();throw a})}(e,a)}}}function t(s,o,i){var l=angular.noop,d=void 0;return{setErrorAlert:function(e){l=e},setPath:function(e){d=e},get:e("get"),post:e("post"),put:e("put"),delete:e("delete")};function e(r){return function(e,a,t){return function(e,a,t,r){var n={method:e,url:d+a,headers:{Authorization:"Bearer "+s.getToken()}};t=t||{},r&&(t.pageLength=o.itemsPerPage,t.pageNum=r.currentPage-1);switch(e){case"get":case"delete":n.params=t;break;case"post":case"put":n.data=t}return i(n).then(function(e){var a=e.data;r&&(r.totalItems=a.totalElements,r.data=a.content);return a},function(e){console.error(e.statusText);var a=e.data;"message"in a&&console.error(a.message);401==e.status?s.logout():l();throw a})}(r,e,a,t)}}}function r(r,a){return{doLogin:function(e,a){return r.request("ValidarUsuario",[e,a,"",!1,"web"]).then(function(e){return e[0]})},checkPermissions:function(e){return r.request("ObtenerPermisos",[a.userData.id_usuario,e])},resetPassword:function(e,a,t){return r.request("CambiarPassword",[e,a,t])},updateUserPicture:function(e,a){return r.request("ActualizarFotoUsuario",[e,a])}}}function n(e,a,t){var r={token:"ptToken",userData:"ptUserData"},n=e.localStorage;return{start:function(e){s(e),n.setItem(r.token,e.token)},isUserAuthorized:function(){return null!==o()},setUserData:s,getUserData:function(){var e=n.getItem(r.userData);return null!==e?angular.fromJson(e):null},getToken:o,logout:function(){n.clear(),delete a.userData,t.go("login")}};function s(e){n.setItem(r.userData,angular.toJson(e)),a.userData=e}function o(){return n.getItem(r.token)}}function s(a,t){return function(e){return a.show({template:t.modal,controller:"PtModalController",locals:{modalTabIndex:e||0}})}}e.$inject=["$locale"],a.$inject=["$http","ptSessionService","$rootScope"],t.$inject=["ptSessionService","uibPaginationConfig","$http"],r.$inject=["dsApi","$rootScope"],n.$inject=["$window","$rootScope","$state"],s.$inject=["$mdDialog","PT_TEMPLATES"],angular.module("proaTools.intranet").factory("getLang",e).factory("getStringDate",function(){return function(e){return e instanceof Date?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():""}}).factory("dsApi",a).factory("springApi",t).factory("ptApiService",r).factory("ptSessionService",n).factory("ptOpenProfileModal",s)}(),angular.module("proaTools.intranet").value("$extraLocale",{DATETIME_FORMATS:{paddedMedium:"MM/dd/yyyy HH:mm:ss",paddedMediumDate:"MM/dd/yyyy",paddedMediumTime:"HH:mm:ss",paddedShort:"MM/dd/yyyy HH:mm",paddedShortDate:"MM/dd/yyyy",paddedShortTime:"HH:mm",filenameMedium:"M-d-yyyy H.mm.ss",filenameMediumDate:"M-d-yyyy",filenameMediumTime:"H.mm.ss"},RANGE_SEP:"-",ANSWERS:["No","Yes"]});
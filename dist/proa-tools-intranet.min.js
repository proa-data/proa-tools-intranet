/*!
 * Proa Tools Intranet v4.0.0 (https://github.com/proa-data/proa-tools-intranet)
 */
angular.module("proaTools.intranet",["ngLocale","ui.router","pascalprecht.translate","ngMaterial","ui.bootstrap","proaTools.records","proaTools.forms"]),function(){function e(e){e.useStaticFilesLoader({prefix:"json/lang/",suffix:".json"}).useSanitizeValueStrategy(null)}e.$inject=["$translateProvider"],angular.module("proaTools.intranet").config(e)}(),angular.module("proaTools.intranet").constant("PT_TEMPLATES",{login:'<div class="container" id="container-login"><div><img class="img-responsive center-block" src="img/logo.png"><h1 class="h3 text-center" translate="largeTitle"></h1><form class="form-horizontal" ng-submit="submit()"><div class="form-group"><label class="col-sm-4 control-label" translate="login.user"></label><div class="col-sm-8"><input type="text" class="form-control" ng-model="loginData.user" required></div></div><div class="form-group"><label class="col-sm-4 control-label" translate="login.password"></label><div class="col-sm-8"><input type="password" class="form-control" ng-model="loginData.pw" required></div></div><div class="form-group" ng-if="selectCompany"><label class="col-sm-4 control-label" translate="login.company"></label><div class="col-sm-8"><select class="form-control" ng-model="$root.userData.id_empresa" ng-options="item.id as item.name for item in companyItems" ng-change="submitWithCompany()"></select></div></div><button type="submit" class="btn btn-primary btn-block" translate="login.login"></button></form><p class="alert alert-danger" ng-show="notPermiss" translate="login.error.noLogin"></p><p class="alert alert-danger" ng-show="requiredUpdatePassword" translate="login.error.update_password_required"></p><p class="alert alert-danger" ng-show="errorServer" translate="login.error.server"></p></div></div>',main:'<header><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" ng-click="isNavCollapsed=!isNavCollapsed"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-brand" ng-if="$root.userData.logo_contenido"><img ng-src="data:image/png;base64,{{$root.userData.logo_contenido}}"></div></div><div class="navbar-text"><ol class="breadcrumb"><li ng-repeat="item in $root.breadcrumbList" ng-class="{active: item.sref}"><a ui-sref="{{item.sref}}" translate="{{item.translationId}}" ng-if="item.sref"></a><span translate="{{item.translationId}}" ng-if="!item.sref"></span></li></ol></div><ul class="nav navbar-nav navbar-right"><li uib-dropdown><a href="" uib-dropdown-toggle role="button"><img class="img-responsive img-circle" ng-src="data:image/jpeg;base64,{{$root.userData.contenido_foto}}" onerror="this.onerror=null;this.src=\'img/default-avatar.jpg\'"> <span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">{{$root.userData.nombre}} ({{$root.userData.id_usuario}})</li><li role="separator" class="divider"></li><li><a href="" ng-click="openModal()"><span class="fas fa-user fa-fw"></span> <span translate="manageUser.title_dropdown"></span></a></li><li><a href="" ng-click="logout()"><span class="fas fa-power-off fa-fw"></span> <span translate="manageUser.logout_dropdown"></span></a></li></ul></li></ul><div class="navbar-collapse" uib-collapse="isNavCollapsed"><ul class="nav navbar-nav"><li ng-repeat-start="item in navList" ng-if="isDisplayed(item)&&item.submenu"><a href="" ng-init="isSubnavCollapsed=true" ng-click="isSubnavCollapsed=!isSubnavCollapsed"><span ng-include="\'nav-content.html\'"></span> <span class="caret"></span></a><ul class="nav navbar-nav" uib-collapse="isSubnavCollapsed"><li ui-sref-active="active" ng-include="\'nav-link.html\'" ng-repeat="item in item.submenu" ng-if="isDisplayed(item)"></li></ul></li><li ui-sref-active="active" ng-include="\'nav-link.html\'" ng-repeat-end ng-if="isDisplayed(item)&&!item.submenu"></li></ul></div></div></nav><script type="text/ng-template" id="nav-link.html"><a ui-sref="main.{{item.name}}" ng-include="\'nav-content.html\'"></a><\/script><script type="text/ng-template" id="nav-content.html"><span class="fa-fw" ng-class="item.iconClassName" ng-if="item.iconClassName"></span><span ng-if="item.iconClassName"> </span><span translate="{{item.name}}.title"></span><\/script></header><main class="container-fluid" ui-view></main>',modal:'<md-dialog flex="50"><md-toolbar><div class="md-toolbar-tools"><h2 translate="manageUser.title"></h2><span flex></span><md-button class="md-icon-button" ng-click="closeDialog()"><span class="fas fa-times"></span></md-button></div></md-toolbar><md-dialog-content><md-tabs md-selected="modalTabIndex" md-dynamic-height md-border-bottom><md-tab label="updateData"><md-tab-label><span translate="manageUser.updateData"></span></md-tab-label><md-tab-body><div class="tab-body"><form ng-submit="saveData()"><p class="alert alert-danger" translate="manageUser.noUserData" ng-show="isNoUserData()"></p><div class="form-group"><label translate="manageUser.nif"></label><input type="text" class="form-control" ng-model="data.nif" required></div><div class="form-group"><label translate="manageUser.email"></label><input type="email" class="form-control" ng-model="data.email" required></div><button type="submit" class="btn btn-primary" translate="save"></button></form></div></md-tab-body></md-tab><md-tab label="updatePassword"><md-tab-label><span translate="manageUser.updatePassword"></span></md-tab-label><md-tab-body><div class="tab-body"><form ng-submit="saveNewPassword()"><div class="form-group" ng-class="{\'has-error\': failOldPassword&&submittedResetPassword}"><label translate="manageUser.password.current"></label><input type="password" ng-model="resetPasswordForm.current_password" class="form-control" required></div><div class="form-group"><label translate="manageUser.password.new"></label><input type="password" ng-model="resetPasswordForm.new_password" class="form-control" required></div><div class="form-group" ng-class="{\'has-error\': failSameNewPassword&&submittedResetPassword}"><label translate="manageUser.password.repeatNew"></label><input type="password" ng-model="resetPasswordForm.repeat_new_password" class="form-control" required></div><p class="alert alert-danger" translate="manageUser.password.fail_new_password" ng-if="failSameNewPassword"></p><p class="alert alert-danger" translate="manageUser.password.fail_old_password" ng-if="failOldPassword"></p><button type="submit" class="btn btn-primary"><span class="fas fa-sync-alt"></span><span translate="manageUser.password.update"></span></button></form></div></md-tab-body></md-tab><md-tab label="updatePicture"><md-tab-label><span translate="manageUser.updatePicture"></span></md-tab-label><md-tab-body><div class="tab-body text-center"><img id="profileImage" ng-src="data:image/jpeg;base64,{{photoContent}}" class="img-responsive img-circle center-block" alt="Profile picture" onerror="this.onerror = null;this.src=\'img/default-avatar.jpg\'" width="150"><input type="file" id="input-new-image" accept="image/*;capture=camera" onchange="angular.element(this).scope().processNewImage(this)" image="" resize-max-height="1000" resize-max-width="1000" resize-quality="0.7" resize-type="image/jpg" accept=".jpg,.jpeg,.png" class="hidden"><button type="button" class="btn btn-primary" ng-click="getNewImage()"><span class="fas fa-camera fa-2x"></span></button></div></md-tab-body></md-tab></md-tabs></md-dialog-content></md-dialog>',home:'<h1 class="h3" translate="largeTitle"></h1>'}),function(){function e(t,n,e,r,o,a,s){function i(){a.getCompanies().then(function(e){e?(t.companyItems=e,1==t.companyItems.length?(r.userData.id_empresa=t.companyItems[0].id,r.userData.id_oficina=t.companyItems[0].officeCode,n.start(r.userData),l()):t.selectCompany=!0):t.errorServer=!0})}function l(){s.go("main.home")}t.loginData={},t.selectCompany=!1,t.submit=function(){e.doLogin(t.loginData.user,md5(t.loginData.pw)).then(function(e){if(e){n.start(e);var a=r.userData;a&&a.validado?(t.requiredUpdatePassword=!1,t.loginData.user==t.loginData.pw?o(1).then(function(e){e?i():t.requiredUpdatePassword=!0}):i()):void 0===a?t.errorServer=!0:t.notPermiss=!0}else void 0===e?t.errorServer=!0:t.notPermiss=!0})},t.submitWithCompany=function(){0!=r.userData.id_empresa&&(angular.forEach(t.companyItems,function(e){e.id==r.userData.id_empresa&&(r.userData.id_oficina=e.officeCode)}),n.start(r.userData),l())},n.logout()}function a(t,n,o,s,i,e){t.navList=[];var l={};function u(){o.logout()}function c(){e()}t.isDisplayed=function(e){return l[e.name]},t.logout=u,t.openModal=c,function(){var e=n.userData;if(!o.isUserAuthorized()||null===e)return u();e.nif&&e.email||c();t.navList=s;var r=[];angular.forEach(s,function(a){var e=a.submenu;e?angular.forEach(e,function(e){(e=angular.copy(e)).parent=a.name,r.push(e)}):r.push(a)});var a={};angular.forEach(r,function(e){a[e.permission]=1}),a=_.keys(a),i.checkPermissions(a.join()).then(function(e){if(e){var a=e[0].permisos,t=o.getUserData();t.permisos=a,o.setUserData(t),angular.forEach(a,function(n){angular.forEach(r,function(e){if(n.recurso==e.permission){var a=!!n.visualizar;if(l[e.name]=a){var t=e.parent;t&&(l[t]=!0)}}})})}})}()}function t(e,o,a,t,n,s,i){var l=e.userData;function r(){t.hide()}o.modalTabIndex=a,o.closeDialog=r,o.data={nif:l.nif,email:l.email},o.isNoUserData=function(){var e=o.data;return!(e.nif&&e.email)},o.saveData=function(){var e=angular.copy(o.data);n.request("GuardarDatosUsuario",[l.id_usuario,e]).then(function(){l.nif=e.nif,l.email=e.email,s.setUserData(l),r()})},o.saveNewPassword=function(){o.submittedResetPassword=!0,o.failSameNewPassword=!1,o.failOldPassword=!1,o.emptyNewPassword=!1;var e=l.id_usuario;if(null==o.resetPasswordForm)o.emptyNewPassword=!0;else{var a=o.resetPasswordForm.current_password,t=o.resetPasswordForm.new_password,n=o.resetPasswordForm.repeat_new_password;t!==n?o.failSameNewPassword=!0:null==t?o.emptyNewPassword=!0:i.resetPassword(e,md5(a),md5(t)).then(function(e){var a=e;1==a[0]?r(a[0]):o.failOldPassword=!0})}},o.submittedResetPassword=!1,o.photoContent=l.contenido_foto,o.getNewImage=function(){document.getElementById("input-new-image").click(),o.invalidQRCode=!1,o.isRequired=!1,o.noResultsVehicle=!1,o.vehicleNumberNew=""},o.processNewImage=function(e){o.errorUpdatingPicture=!1;var a=l.id_usuario,t=e.files,r=new FileReader;r.onload=function(){var n=r.result;i.updateUserPicture(a,n).then(function(e){var a=e;if(1==a[0].fields.Fresultado){var t=n.substring(n.indexOf(",")+1);l.ruta_foto=a[0].fields.Fmensaje,l.contenido_foto=t,s.setUserData(l),document.getElementById("profileImage").src=n}else o.errorUpdatingPicture=!0})},r.readAsDataURL(t[0])}}e.$inject=["$scope","ptSessionService","ptApiService","$rootScope","ptOpenProfileModal","dataService","$state"],a.$inject=["$scope","$rootScope","ptSessionService","ptScreens","ptApiService","ptOpenProfileModal"],t.$inject=["$rootScope","$scope","modalTabIndex","$mdDialog","dsApi","ptSessionService","ptApiService"],angular.module("proaTools.intranet").controller("PtLoginController",e).controller("PtMainController",a).controller("PtModalController",t)}(),function(){function e(l){return{restrict:"E",compile:function(e,a){var o=angular.isDefined(a.multiple),s=a.ngModel,t=e.find("md-option"),n=t.attr("ng-repeat").split("in")[1].split("|")[0],i=t.attr("ng-value").split(".")[1];return function(r){r.$watch(n,function(e){var a={};angular.forEach(e,function(e){a[e[i]]=!0});var t,n=r.$eval(s);o?(t=[],angular.forEach(n,function(e){e in a&&t.push(e)}),l(function(){r.$$finalSelectedValue=t,r.$eval(s+"=$$finalSelectedValue"),delete r.$$finalSelectedValue})):n in a||r.$eval(s+"=undefined")})}}}}function a(a){return{restrict:"E",template:'<div class="modal-backdrop fade in" id="modal-backdrop-spinner" ng-show="isLoading()"><md-progress-circular md-mode="indeterminate"></md-progress-circular></div>',replace:!0,scope:!0,link:function(e){e.isLoading=function(){return a.pendingRequests.length}}}}e.$inject=["$timeout"],a.$inject=["$http"],angular.module("ngMaterial").directive("mdSelect",e),angular.module("proaTools.intranet").directive("ptSpinner",a)}(),function(){function e(e,n){var r=new RegExp("\\s*\\"+e.NUMBER_FORMATS.CURRENCY_SYM+"\\s*","g"),o=e.RANGE_SEP;return function(e){var a=[];for(var t in e)a[t]=n(e[t]).replace(r,"");return n(1/0).replace("∞",a.join(o))}}function a(e){var a=e.ANSWERS;return function(e){return a[e?1:0]}}e.$inject=["$locale","currencyFilter"],a.$inject=["$locale"],angular.module("proaTools.intranet").filter("currencyRange",e).filter("answer",a)}(),function(){function e(d,a,t){var m=[];this.$get=function(){return m},this.setAll=function(e){d.state("login",{url:"/login",template:a.login,controller:"PtLoginController"}).state("main",{url:"/",template:a.main,controller:"PtMainController"}).state("main.home",{url:"home",template:a.home}),t.otherwise("/home");var c={};angular.forEach(e,function(e){var a=e.parent,t={name:e.name,permission:e.permission,iconClassName:e.iconClassName};if(a){var n=c[a];n||(n=c[a]=[]),n.push(t)}else m.push(t);if(!e.noTemplate){var r=e.name,o=_.kebabCase(r),s={url:o,templateUrl:"app/"+o+"/view.html",resolve:e.resolve},i="main."+r,l=e.param;if(e.noController||(s.controller=_.upperFirst(r)+"Controller"),a&&(s.data={parentMenu:a}),d.state(i,s),l){var u=angular.copy(s);u.url="/:"+l,d.state(i+"."+l,u)}}}),angular.forEach(c,function(a,t){angular.forEach(m,function(e){e.name==t&&(e.submenu=a)})})}}e.$inject=["$stateProvider","PT_TEMPLATES","$urlRouterProvider"],angular.module("proaTools.intranet").provider("ptScreens",e)}(),function(){function e(e,a,t,n,r,o,i,s,l){e.use(a()),angular.merge(t,n);var u=t.DATETIME_FORMATS;r.shortDays=u.SHORTDAY,r.firstDayOfWeek=[1,2,3,4,5,6,0][u.FIRSTDAYOFWEEK];var c=u.paddedShortDate.replace(/y/g,"Y").replace(/d/g,"D");function d(e,a){return(e?e+".":"")+(a||"title")}r.formatDate=function(e){if(!e)return"";var a=e.toLocaleTimeString(),t=e;return 0!==e.getHours()||-1===a.indexOf("11:")&&-1===a.indexOf("23:")||(t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),1,0,0)),moment(t).format(c)},r.parseDate=function(e){var a=moment(e,c,!0);return a.isValid()?a.toDate():new Date(NaN)},o.get("about.json").then(function(e){var a=e.data;console.info('Package: "'+a.name+'" v'+a.version+".")}),i.$on("$stateChangeSuccess",function(e,a){var t=a.name,n=t.split(".")[1],r=[],o=a.data;if(i.pageTitleTranslationId=d(n,"largeTitle"),n&&r.push({translationId:d(n),sref:t}),o){var s=o.parentMenu;s&&r.unshift({translationId:d(s)})}i.breadcrumbList=r}),i.userData=s.getUserData(),Date.prototype.toJSON=function(){var e=l(this,"yyyy-M-d H:m:s");return angular.isDate(e)?null:e}}e.$inject=["$translate","getLang","$locale","$extraLocale","$mdDateLocale","$http","$rootScope","ptSessionService","dateFilter"],angular.module("proaTools.intranet").run(e)}(),function(){function e(e){return function(){return e.id.split("-").shift()}}function a(r,o,s){var i=angular.noop,l=void 0;return{setErrorAlert:function(e){i=e},setPath:function(e){l=e+"datasnap/rest/TMethods/"},request:function(e,a){return function(e,a){var t={"User-Token":o.getToken()},n=s.userData;n&&(t["User-Company"]=n.id_empresa);return r.post(l+e,{_parameters:a||[]},{headers:t}).then(function(e){var a=e.data,t=a[0];if(t){var n=t.fields;if(n&&!1===n.Fresultado)throw console.error(n.Fmensaje),i(),a}return a},function(e){var a=e.data,t=a.error;console.error(t||a),403==e.status||t&&t.includes("NOT_VALIDATED")?o.logout():i();throw a})}(e,a)}}}function t(o,s,i){var l=angular.noop,u=void 0;return{setErrorAlert:function(e){l=e},setPath:function(e){u=e},get:e("get"),post:e("post"),put:e("put"),delete:e("delete")};function e(n){return function(e,a,t){return function(e,a,t,n){var r={method:e,url:u+a,headers:{Authorization:"Bearer "+o.getToken()}};t=t||{},n&&(t.pageLength=s.itemsPerPage,t.pageNum=n.currentPage-1);switch(e){case"get":case"delete":r.params=t;break;case"post":case"put":r.data=t}return i(r).then(function(e){var a=e.data;n&&(n.totalItems=a.totalElements,n.data=a.content);return a},function(e){console.error(e.statusText);var a=e.data;"message"in a&&console.error(a.message);401==e.status?o.logout():l();throw a})}(n,e,a,t)}}}function n(n,a){return{doLogin:function(e,a){return n.request("ValidarUsuario",[e,a,"",!1,"web"]).then(function(e){return e[0]})},checkPermissions:function(e){return n.request("ObtenerPermisos",[a.userData.id_usuario,e])},resetPassword:function(e,a,t){return n.request("CambiarPassword",[e,a,t])},updateUserPicture:function(e,a){return n.request("ActualizarFotoUsuario",[e,a])}}}function r(e,a,t){var n={token:"ptToken",userData:"ptUserData"},r=e.localStorage;return{start:function(e){o(e),r.setItem(n.token,e.token)},isUserAuthorized:function(){return null!==s()},setUserData:o,getUserData:function(){var e=r.getItem(n.userData);return null!==e?angular.fromJson(e):null},getToken:s,logout:function(){r.clear(),delete a.userData,t.go("login")}};function o(e){r.setItem(n.userData,angular.toJson(e)),a.userData=e}function s(){return r.getItem(n.token)}}function o(a,t){return function(e){return a.show({template:t.modal,controller:"PtModalController",locals:{modalTabIndex:e||0}})}}e.$inject=["$locale"],a.$inject=["$http","ptSessionService","$rootScope"],t.$inject=["ptSessionService","uibPaginationConfig","$http"],n.$inject=["dsApi","$rootScope"],r.$inject=["$window","$rootScope","$state"],o.$inject=["$mdDialog","PT_TEMPLATES"],angular.module("proaTools.intranet").factory("getLang",e).factory("getStringDate",function(){return function(e){return e instanceof Date?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():""}}).factory("dsApi",a).factory("springApi",t).factory("ptApiService",n).factory("ptSessionService",r).factory("ptOpenProfileModal",o)}(),angular.module("proaTools.intranet").value("$extraLocale",{DATETIME_FORMATS:{paddedMedium:"MM/dd/yyyy HH:mm:ss",paddedMediumDate:"MM/dd/yyyy",paddedMediumTime:"HH:mm:ss",paddedShort:"MM/dd/yyyy HH:mm",paddedShortDate:"MM/dd/yyyy",paddedShortTime:"HH:mm",filenameMedium:"M-d-yyyy H.mm.ss",filenameMediumDate:"M-d-yyyy",filenameMediumTime:"H.mm.ss"},RANGE_SEP:"-",ANSWERS:["No","Yes"]});